---
layout: post
title: Developing an Integrated Accessory Controller
---
![3D mockup of a PCBA](/images/Sytrol/Sytrol Controller 3D.png)

Following my previous project involving accessing my car's CAN bus, I was interested in expanding on the idea by making a custom controller that can interface with a vehicle via the CAN bus to control various accesories.<!--more-->

I subsequently started designing this printed circuit board. This unit integrates:

* A CAN interface
* A RS-485 interface
* Interfacing for a Yaesu MH-48 handheld microphone with a DTMF keypad
* 8x optical isolators for low current accessories (such as contact closure inputs on equipment)
* 8x SPST relays rated at 5A for powering various accesories

![Schematic of the microcontroller and I2C expander](/images/Sytrol/Sytrol MCU.png)

At the heart of the unit is an atmega328 operating as an Arduino, and a MCP23017 I2C expander IC. The Arduino can interface with devices over I2C, CAN bus, RS-485, or receive user input through the MH-48 microphone. Depending on how the unit is programmed, the Arduino can switch relays, activate opto-isolators, or generate CAN bus or RS-485 data.

![3D mockup of a PCBA](/images/Sytrol/Sytrol mic amp 3D.png)

To allow the use of the  MH-48 as a microphone for a public address (PA) system, a small amplifier is needed within the microphone. Usually, the head unit of a radio is mounted in the front of the car, and amplifies the low level audio signal being generated by the mic before it travels to wherever the actual transceiver is mounted; since the audio signal travelling through the car is very large, its less prone to picking up electronic interference which would lead to noisy audio.

![Yaesu FT-7900r control head schematics](/images/Sytrol/Yaesu FT-7900 control head audio.png)

As you can see, the Yaesu FT-7900r feeds the incoming audio from the microphone into a set of op-amps that boosts the voltage of the signal up significantly.

![Yaesu FT-7900r transceiver schematics](/images/Sytrol/Yaesu FT-7900 tranceiver audio.png)

When the audio reaches the transceiver unit another set of op-amps decreases the level of the signal to whatever is required to properly modulate the transmitter.

This PCB is still in development. There are several changes to be made in the hardware, and compatibility with software must be tested before the PCB is finalized.
