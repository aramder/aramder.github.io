---
layout: post
category: misadventures
title: Disneyland 70th Anniversary Key WLED Conversion
---
![70th Anniversary Key next to my custom Mickey Sorcerer's hat](/images/70th_Key_WLED/key_and_hat.jpg)

For Disneyland's 70th anniversary, they released this giant lightup key which contains a pin which you can unlock by inserting the key into various locks around the park. I decided to retrofit the key with an ESP01 running WLED.<!--more-->

Let's start with a teardown of the key. I was curious what kind of mechanism they decided to use for triggering both the key itself and the lock stations when the key is inserted. 

![Key head disassembled to show the NFC tag and IR receiver](/images/70th_Key_WLED/key_head_disassembled.jpg)

It looks like the key contains an NFC tag which activates the lock station, and the key station has an infrared LED transmitted in the lock which is ready by an infrared receiver in the tip of the key.

![Closeup of IR receiver](/images/70th_Key_WLED/IR_receiver.jpg)

Here is a closeup of the 940nm IR 38kHz receiver - either a TSOP1238 or HL-1238. This kind of 38kHz encoded IR communication system is fairly ubiquitous and is often seen in IR remotes for TVs, stereos, etc.

![Initial disassembly](/images/70th_Key_WLED/disassembly_initial.jpg)

The key implements addressable LEDs on a set of three PCBs. The middle board uses foam to diffuse the light in the shaft of the key, and has a lightbox section for displaying icons representing the individual lands.

![Closeup of lightbox](/images/70th_Key_WLED/disassembly_lightbox.jpg)

The lightbox section employs what looks like a transparency sheet printed with the various icons.

![Disassembled key illuminated](/images/70th_Key_WLED/disassembly_lit.jpg)

Here's the disassembled PCB illuminated.

![Main board bottom](/images/70th_Key_WLED/main_board.jpg)

The main board has two ICs - a microcontroller and a flash IC.

![Main board MCU](/images/70th_Key_WLED/mcu.jpg)

The MCU is one from Zhuhai Jieli Technology. Their ICs are fairly common in cheap documentation like this, and seriously lack publicly available documentation.

![Main board flash](/images/70th_Key_WLED/flash.jpg)

The flash conceivably contains the audio samples, and perhaps the LED patterns.

![Key outfitted with ESP01](/images/70th_Key_WLED/ESP01.jpg)

I wired in the ESP01 running WLED to the main board through a switch which enables power to the ESP01, and selects which MCU is connected to the first LED in the addressable LED daisy chain. Annoyingly, the stock MCU switches the power to the LEDs, and turns them off after a set idle period. The MOSFET used to control this must be driven in order to run the LEDs continuously.

![Key closeout with the outfitted ESP01](/images/70th_Key_WLED/closeout.jpg)

The ESP01 and additional wiring can be tucked neatly under the main PCB.
